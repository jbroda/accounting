$(document).ready(function(){function r(n,t){console.log("getStatement(): start date is "+t);t&&(n=n.replace(/\d{4}-\d{2}-\d{2}/,t),console.log("new href: "+n));var u=getUUID(),r=$.ajax({type:"GET",url:n+u+"/"});return bootbox.dialog({animate:!1,message:"<p>Generating a statement for "+i+" ... <\/p><div class='progress'><div class='progress-bar progress-bar-striped active'role='progressbar' aria-valuemin='0' aria-valuemax='100'aria-valuenow='100' style='width: 100%'><\/div><\/div>",closeButton:!1,buttons:{danger:{label:"Cancel",className:"btn-danger",callback:function(){console.log('Cancel for statement request "'+u+'" pressed!');var n=$.ajax({type:"POST",url:"/accounting/report/cancel/statement/"+u+"/"});n.done(function(n){console.log("cancelRq done "+n)});n.fail(function(n,t){console.log("cancelRq fail "+t)});n.always(function(){console.log("cancelRq complete")});r.abort()}}}}),r.done(function(n){url=n.url;path=n.path;console.log("Received statement URL: "+url);bootbox.hideAll();var t=window.open(url,"_blank");popupBlockerChecker.check(t);t||bootbox.dialog({message:"Click <a href="+url+"><b><u>here<\/u><\/b><\/a> the account "+i+" statement!"})}),r.fail(function(n,t){console.log("failure: "+t);bootbox.hideAll();t=="abort"?bootbox.alert("Statement cancelled!"):bootbox.alert("Failed to generate the statement: "+t+"!")}),r.always(function(){console.log("Request for the statement is complete!")}),!1}var i=$("input[name='accounts']").val(),e=$("#balance").text(),n;$("#select_"+i).prop("checked",!0);$("#accounts-table").dataTable();$.extend($.fn.dataTableExt.oSort,{"datetime-us-pre":function(n){return dateTimeSort(n)},"datetime-us-asc":function(n,t){return n-t},"datetime-us-desc":function(n,t){return t-n}});$.fn.dataTableExt.aTypes.unshift(function(n){return dateTimeSortType(n)});n=$("#transaction-table").dataTable({dom:"<'row'<'col-sm-4'l><'editmode'><'col-sm-4'f>r<'col-sm-3 tools'<'pull-right'TB>>>t<'row'<'col-sm-6'i><'col-sm-6'p>>",buttons:["copy","csv","print",],aaSorting:[[0,"desc"]],aoColumns:[null,null,null,{sType:"numeric"},{sType:"datetime-us"}],aoColumnDefs:[{bSortable:!1,aTargets:[1,2,3]},{sWidth:"5em",aTargets:[0]},{sWidth:"5em",aTargets:[2]},{sWidth:"5em",aTargets:[3]},{aDataSort:[4,3],aTargets:[0]},],bPaginate:!0,bLengthChange:!0,bFilter:!0,bSort:!0,bInfo:!0,bAutoWidth:!1,asStripeClasses:["odd","even"],iDisplayLength:10,stateSave:!1,oLanguage:{sSearch:"Filter:",sInfo:"Showing _START_ to _END_ of _TOTAL_ transactions",sLengthMenu:'Display <select><option value="10">10<\/option><option value="20">20<\/option><option value="30">30<\/option><option value="40">40<\/option><option value="60">60<\/option><option value="-1">All<\/option><\/select> transactions per page'}});$("div.editmode").html("<div class='col-sm-1'><button id='toggle_edit' title='Toggle Edit Mode'        type='button' class='btn btn-xs btn-default'>        <span aria-hidden='true' class='glyphicon glyphicon-edit'/>         <span id='text'>Off<\/span><\/button><\/div>");$.fn.editable.defaults.mode="inline";var t=n.fnSettings(),u=t._iDisplayLength,f=t._iDisplayStart;t._iDisplayLength=-1;n.fnDraw();$(".editable_memo").editable("disable",{type:"text",title:"Edit Memo"});t._iDisplayLength=u;t._iDisplayStart=f;n.fnDraw();$.fn.toggleText=function(n,t){var i=$("#text",this);return i.text()==n?i.text(t):i.text(n),this};$("#toggle_edit").click(function(){var t=n.fnSettings(),i=t._iDisplayLength,r=t._iDisplayStart;t._iDisplayLength=-1;n.fnDraw();$(".editable_memo").editable("toggleDisabled");$(this).toggleClass("btn-default");$(this).toggleClass("btn-primary");$(this).toggleClass("active");$(this).toggleText("On","Off");t._iDisplayLength=i;t._iDisplayStart=r;n.fnDraw(!0)});$("input:checkbox[id=payment_plan]").click(function(){var r=$(this).prop("checked"),t=$("#unit_address").val(),i=$("#unit_number").val(),n;bootbox.dialog({message:"Updating <b>Payment Plan<\/b> status for "+t+" #"+i+" ...",animate:!1,closeButton:!1});n=$.ajax({type:"POST",url:"update/",traditional:!0,data:{unit_address:t,unit_number:i,is_payment_plan:r},dataType:"html"});n.done(function(){var n=$("input:checkbox[id=payment_plan]").prop("checked");console.log("Payment Plan flag: "+n);bootbox.hideAll()});n.fail(function(n,t){console.log("failure: "+t);bootbox.hideAll();alert("Request failed: "+t)})});$("input:checkbox[id=no_statement]").click(function(){var r=$(this).prop("checked"),t=$("#unit_address").val(),i=$("#unit_number").val(),n;bootbox.dialog({message:"Updating <b>No Statement<\/b> status for "+t+" #"+i+" ...",animate:!1,closeButton:!1});n=$.ajax({type:"POST",url:"update/",traditional:!0,data:{unit_address:t,unit_number:i,is_no_statement:r},dataType:"html"});n.done(function(){var n=$("input:checkbox[id=no_statement]").prop("checked");console.log("No Statement flag: "+n);bootbox.hideAll()});n.fail(function(n,t){console.log("failure: "+t);bootbox.hideAll();alert("Request failed: "+t)})});$("input:checkbox[id=email_statement]").click(function(){var r=$(this).prop("checked"),t=$("#unit_address").val(),i=$("#unit_number").val(),n;bootbox.dialog({message:"Updating <b>E-Statement<\/b> status for "+t+" #"+i+" ...",animate:!1,closeButton:!1});n=$.ajax({type:"POST",url:"update/",traditional:!0,data:{unit_address:t,unit_number:i,is_email_statement:r},dataType:"html"});n.done(function(){var n=$("input:checkbox[id=email_statement]").prop("checked");console.log("E-Statement flag: "+n);bootbox.hideAll()});n.fail(function(n,t){console.log("failure: "+t);bootbox.hideAll();alert("Request failed: "+t)})});$(".statement").click(function(n){var f;console.log(this.id+" statement requested: "+this.href);n.preventDefault();var u=this.href,t=new DateTime,i=t.sym.d.yyyy+"-"+t.sym.d.mm+"-"+t.sym.d.dd;if(this.id=="reo")return f=t.sym.d.mmmm+" "+t.sym.d.dd+", "+t.sym.d.yyyy,bootbox.dialog({animate:!1,title:"Select starting date",message:'<div class="input-group date"id="dtpicker_reo" data-date-format="MMMM DD, YYYY"><input class="form-control"id="reo_statement_date" name="reo_statement_date"type="text"value="'+f+'" /><span class="input-group-addon"><span class="fa fa-calendar"><\/span><\/span><\/div>',buttons:{success:{label:"Get Statement",className:"btn-success",callback:function(){t=new DateTime($("#reo_statement_date").val());i=t.sym.d.yyyy+"-"+t.sym.d.mm+"-"+t.sym.d.dd;console.log("New start date: "+i);r(u,i)}}}}),$("#dtpicker_reo").datetimepicker({pickTime:!1}),!1;r(u,i)})});